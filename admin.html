<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PFL Admin Panel</title>
<style>
body { font-family: Arial,sans-serif; margin:0; background:#111; color:#fff; }
header { background:gold; color:black; text-align:center; font-weight:bold; padding:15px;}
.container {padding:10px; max-width:1200px; margin:auto;}
.card {background:#222; border:1px solid gold; border-radius:8px; padding:10px; margin-bottom:10px;}
label {display:block; margin-top:5px;}
input, select {margin-top:3px; padding:5px; border-radius:4px; border:none; width:100%;}
button {margin-top:10px; padding:10px; background:gold; color:black; border:none; border-radius:5px; cursor:pointer;}
h2 {margin-top:20px;}
</style>
</head>
<body>
<header>PFL Admin Panel</header>
<div class="container">
<div id="loginDiv">
  <h2>Admin Login</h2>
  <label>Password:</label>
  <input type="password" id="adminPassword" placeholder="Enter password">
  <button onclick="login()">Login</button>
</div>

<div id="adminDiv" style="display:none;">
  <h2>Manage Matches</h2>
  <label>Select Match Day:</label>
  <select id="matchDaySelect"></select>

  <div id="matchesContainer"></div>
  <button onclick="saveData()">Save Locally</button>
  <button onclick="downloadData()">Download JSON</button>
</div>
</div>

<script>
// ----- Admin Config -----
const ADMIN_PASS = "Rowland12#";
let data = { teams: [], matchDays: [] };

// ----- Login -----
function login(){
  const pass = document.getElementById("adminPassword").value;
  if(pass===ADMIN_PASS){
    document.getElementById("loginDiv").style.display="none";
    document.getElementById("adminDiv").style.display="block";
    loadData();
  } else { alert("Incorrect password"); }
}

// ----- Load JSON -----
function loadData(){
  fetch("data.json")
    .then(res=>res.json())
    .then(json=>{
      data=json;
      populateMatchDays();
    })
    .catch(err=>{
      alert("No local data.json found, starting fresh");
      data = {
        teams:["Blue Blazzers","Dark Art FC","Shooting Stars","Infinity FC","Courage FC","Dynamos FC","FET 21/26","Team 8"],
        matchDays:[
          {date:"2025-10-28",matches:createEmptyMatches()},
          {date:"2025-11-01",matches:createEmptyMatches()},
          {date:"2025-11-05",matches:createEmptyMatches()},
          {date:"2025-11-09",matches:createEmptyMatches()},
          {date:"2025-11-13",matches:createEmptyMatches()},
          {date:"2025-11-17",matches:createEmptyMatches()}
        ]
      };
      populateMatchDays();
    });
}

// ----- Create Empty Matches -----
function createEmptyMatches(){
  return [
    {home:null,away:null,HT:{home:0,away:0},FT:{home:0,away:0},venue:"Mainbowl",time:"14:00"},
    {home:null,away:null,HT:{home:0,away:0},FT:{home:0,away:0},venue:"Mainbowl",time:"15:00"},
    {home:null,away:null,HT:{home:0,away:0},FT:{home:0,away:0},venue:"Mainbowl",time:"16:00"},
    {home:null,away:null,HT:{home:0,away:0},FT:{home:0,away:0},venue:"Mainbowl",time:"17:00"}
  ];
}

// ----- Populate Match Days -----
function populateMatchDays(){
  const select = document.getElementById("matchDaySelect");
  select.innerHTML="";
  data.matchDays.forEach((day,i)=>{
    const opt=document.createElement("option");
    opt.value=i;
    opt.text=`Match Day ${i+1} - ${day.date}`;
    select.appendChild(opt);
  });
  select.onchange = renderMatches;
  renderMatches();
}

// ----- Render Matches -----
function renderMatches(){
  const idx = document.getElementById("matchDaySelect").value;
  const container = document.getElementById("matchesContainer");
  container.innerHTML="";
  const matchDay = data.matchDays[idx];
  matchDay.matches.forEach((m,i)=>{
    const card = document.createElement("div");
    card.className="card";
    card.innerHTML=`
      <label>Home Team:</label>
      <select id="home-${i}">${data.teams.map(t=>`<option value="${t}" ${t===m.home?'selected':''}>${t}</option>`)}</select>

      <label>Away Team:</label>
      <select id="away-${i}">${data.teams.map(t=>`<option value="${t}" ${t===m.away?'selected':''}>${t}</option>`)}</select>

      <label>HT Score:</label>
      <input type="number" min="0" max="6" value="${m.HT.home}" id="ht-home-${i}" placeholder="Home HT">
      <input type="number" min="0" max="6" value="${m.HT.away}" id="ht-away-${i}" placeholder="Away HT">

      <label>FT Score:</label>
      <input type="number" min="0" max="6" value="${m.FT.home}" id="ft-home-${i}" placeholder="Home FT">
      <input type="number" min="0" max="6" value="${m.FT.away}" id="ft-away-${i}" placeholder="Away FT">

      <label>Venue:</label>
      <select id="venue-${i}">
        <option value="Mainbowl" ${m.venue==="Mainbowl"?'selected':''}>Mainbowl</option>
        <option value="Maracana" ${m.venue==="Maracana"?'selected':''}>Maracana</option>
      </select>

      <label>Time:</label>
      <input type="time" value="${m.time}" id="time-${i}">
    `;
    container.appendChild(card);
  });

  // Allow editing Match Day date
  const dayDate = document.createElement("input");
  dayDate.type="date";
  dayDate.value=matchDay.date;
  dayDate.onchange = e=>{ matchDay.date = e.target.value; };
  container.prepend(document.createTextNode("Match Day Date:"));
  container.prepend(dayDate);
}

// ----- Save Locally -----
function saveData(){
  const idx = document.getElementById("matchDaySelect").value;
  const matchDay = data.matchDays[idx];
  matchDay.matches.forEach((m,i)=>{
    m.home = document.getElementById(`home-${i}`).value;
    m.away = document.getElementById(`away-${i}`).value;
    m.HT.home = parseInt(document.getElementById(`ht-home-${i}`).value);
    m.HT.away = parseInt(document.getElementById(`ht-away-${i}`).value);
    m.FT.home = parseInt(document.getElementById(`ft-home-${i}`).value);
    m.FT.away = parseInt(document.getElementById(`ft-away-${i}`).value);
    m.venue = document.getElementById(`venue-${i}`).value;
    m.time = document.getElementById(`time-${i}`).value;
  });
  alert("Data saved locally! Click 'Download JSON' to update file.");
}

// ----- Download JSON -----
function downloadData(){
  const blob = new Blob([JSON.stringify(data,null,2)], {type:"application/json"});
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href=url;
  a.download="data.json";
  a.click();
  URL.revokeObjectURL(url);
}
</script>
</body>
</html>
